var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.arrayIteratorImpl=function(a){var b=0;return function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}}};$jscomp.arrayIterator=function(a){return{next:$jscomp.arrayIteratorImpl(a)}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,d){a!=Array.prototype&&a!=Object.prototype&&(a[b]=d.value)};
$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);$jscomp.SYMBOL_PREFIX="jscomp_symbol_";$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.Symbol=function(){var a=0;return function(b){return $jscomp.SYMBOL_PREFIX+(b||"")+a++}}();
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.iterator;a||(a=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[a]&&$jscomp.defineProperty(Array.prototype,a,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}});$jscomp.initSymbolIterator=function(){}};
$jscomp.initSymbolAsyncIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.asyncIterator;a||(a=$jscomp.global.Symbol.asyncIterator=$jscomp.global.Symbol("asyncIterator"));$jscomp.initSymbolAsyncIterator=function(){}};$jscomp.iteratorPrototype=function(a){$jscomp.initSymbolIterator();a={next:a};a[$jscomp.global.Symbol.iterator]=function(){return this};return a};
$jscomp.iteratorFromArray=function(a,b){$jscomp.initSymbolIterator();a instanceof String&&(a+="");var d=0,c={next:function(){if(d<a.length){var g=d++;return{value:b(g,a[g]),done:!1}}c.next=function(){return{done:!0,value:void 0}};return c.next()}};c[Symbol.iterator]=function(){return c};return c};
$jscomp.polyfill=function(a,b,d,c){if(b){d=$jscomp.global;a=a.split(".");for(c=0;c<a.length-1;c++){var g=a[c];g in d||(d[g]={});d=d[g]}a=a[a.length-1];c=d[a];b=b(c);b!=c&&null!=b&&$jscomp.defineProperty(d,a,{configurable:!0,writable:!0,value:b})}};$jscomp.polyfill("Array.prototype.keys",function(a){return a?a:function(){return $jscomp.iteratorFromArray(this,function(a){return a})}},"es6","es3");
var start=function(){playMeasure&&(document.getElementById("start").outerHTML="",playMeasure(starts))},playMeasure,VF,context,notation_div,length,x_pos=0,measure_width=150,staves,clefs=["treble","bass","bass"],flats=["A","B","D","E"],voice_cache={},grammar,annotation_age,current_dynamic,dynamic_age=0,tempo_modifier=1.1,track_options=[{gain:1,sustain:1,gain_center:1},{gain:.3,sustain:1,gain_center:.3}];
window.onload=function(){grammar=tracery.createGrammar(grammar_data);VF=Vex.Flow;length=.95*innerWidth;notation_div=document.getElementById("notation");render_staves();createPiano()};function weighted_random(a){for(var b=[],d=Object.keys(a),c=0;c<d.length;c++){var g=d[c],f=a[g];for(j=0;j<f;j++)b.push(g)}return b[Math.floor(Math.random()*b.length)]};var starts=["72/100/480/239|72/0/239/0|75/100/1/239|75/0/239/0|74/100/1/479|74/0/479/0|72/100/1/479|72/0/479/0","41/100/0/1823|56/100/480/911|60/100/0/911|65/100/0/911|56/0/911/0|60/0/0/0|65/0/0/0|56/100/49/455|60/100/0/455|65/100/0/455|41/0/383/0|56/0/72/0|60/0/0/0|65/0/0/0"],dists=[{"76/100/1/50|76/0/50/0|77/100/1/1773|77/0/1773/0":{"72/100/480/239|72/0/239/0|75/100/1/239|75/0/239/0|74/100/1/479|74/0/479/0|72/100/1/479|72/0/479/0":1,"68/100/96/51|68/0/51/0|70/100/1/906|70/0/906/0|68/100/2/51|68/0/51/0|67/100/1/906|67/0/906/0":1},
"72/100/480/239|72/0/239/0|75/100/1/239|75/0/239/0|74/100/1/479|74/0/479/0|72/100/1/479|72/0/479/0":{"72/100/1/51|72/0/51/0|71/100/1/906|71/0/906/0|72/100/2/51|72/0/51/0|71/100/1/860|71/0/860/0":3,"72/100/1/51|72/0/51/0|71/100/1/906|71/0/906/0|68/100/2/51|68/0/51/0|67/100/1/906|67/0/906/0":1,"76/100/1/51|76/0/51/0|77/100/1/906|77/0/906/0|76/100/2/51|76/0/51/0|77/100/1/860|77/0/860/0":2},"72/100/265/239|72/0/239/0|74/100/1/239|74/0/239/0|76/100/1/239|76/0/239/0|77/100/1/239|77/0/239/0|79/100/1/239|79/0/239/0|83/100/1/239|83/0/239/0|79/100/1/239|79/0/239/0":{"77/100/1/479|77/0/479/0|79/100/1/51|79/0/51/0|77/100/1/1386|77/0/1386/0":4},
"77/100/1/479|77/0/479/0|79/100/1/51|79/0/51/0|77/100/1/1386|77/0/1386/0":{"79/100/2/51|79/0/51/0|77/100/1/906|77/0/906/0|77/100/2/51|77/0/51/0|76/100/1/906|76/0/906/0":4},"68/100/96/51|68/0/51/0|70/100/1/906|70/0/906/0|68/100/2/51|68/0/51/0|67/100/1/906|67/0/906/0":{"68/100/1/51|68/0/51/0|70/100/1/906|70/0/906/0|68/100/2/51|68/0/51/0|67/100/1/906|67/0/906/0":1},"68/100/1/51|68/0/51/0|70/100/1/906|70/0/906/0|68/100/2/51|68/0/51/0|67/100/1/906|67/0/906/0":{"68/100/1/51|68/0/51/0|70/100/1/906|70/0/906/0|68/100/2/51|68/0/51/0|67/100/1/906|67/0/906/0":1,
"68/100/1/51|68/0/51/0|67/100/1/426|67/0/426/0|67/100/2/51|67/0/51/0|65/100/1/1363|65/0/1363/0":1},"73/100/2/51|73/0/51/0|72/100/1/906|72/0/906/0|72/100/2/51|72/0/51/0|71/100/1/906|71/0/906/0":{"68/100/1/51|68/0/51/0|67/100/1/426|67/0/426/0|67/100/2/51|67/0/51/0|65/100/1/1363|65/0/1363/0":1},"68/100/1/51|68/0/51/0|67/100/1/426|67/0/426/0|67/100/2/51|67/0/51/0|65/100/1/1363|65/0/1363/0":{"70/0/0/1920":1},"76/100/1/51|76/0/51/0|77/100/1/906|77/0/906/0|76/100/2/51|76/0/51/0|77/100/1/860|77/0/860/0":{"72/100/480/239|72/0/239/0|75/100/1/239|75/0/239/0|74/100/1/479|74/0/479/0|72/100/1/479|72/0/479/0":2},
"65/100/2/51|65/0/51/0|67/100/1/426|67/0/426/0|65/100/2/51|65/0/51/0|67/100/1/1134|67/0/1134/0":{"68/100/254/51|68/0/51/0|67/100/1/404|67/0/404/0|67/100/24/51|67/0/51/0|65/100/1/1363|65/0/1363/0":2},"79/100/2/51|79/0/51/0|77/100/1/906|77/0/906/0|77/100/2/51|77/0/51/0|76/100/1/906|76/0/906/0":{"73/100/2/51|73/0/51/0|72/100/1/906|72/0/906/0|72/100/2/51|72/0/51/0|71/100/1/906|71/0/906/0":4},"72/100/1/51|72/0/51/0|71/100/1/906|71/0/906/0|68/100/2/51|68/0/51/0|67/100/1/906|67/0/906/0":{"65/100/2/51|65/0/51/0|67/100/1/426|67/0/426/0|65/100/2/51|65/0/51/0|67/100/1/1134|67/0/1134/0":1},
"70/0/0/1920":{"68/100/1/51|68/0/51/0|70/100/1/906|70/0/906/0|68/100/2/51|68/0/51/0|67/100/1/906|67/0/906/0":7,"72/100/480/239|72/0/239/0|75/100/1/239|75/0/239/0|74/100/1/479|74/0/479/0|72/100/1/479|72/0/479/0":2,"72/100/265/239|72/0/239/0|74/100/1/239|74/0/239/0|76/100/1/239|76/0/239/0|77/100/1/239|77/0/239/0|79/100/1/239|79/0/239/0|83/100/1/239|83/0/239/0|79/100/1/239|79/0/239/0":4},"72/100/1/51|72/0/51/0|71/100/1/906|71/0/906/0|72/100/2/51|72/0/51/0|71/100/1/860|71/0/860/0":{"72/100/480/239|72/0/239/0|75/100/1/239|75/0/239/0|74/100/1/479|74/0/479/0|72/100/1/479|72/0/479/0":2},
"68/100/254/51|68/0/51/0|67/100/1/404|67/0/404/0|67/100/24/51|67/0/51/0|65/100/1/1363|65/0/1363/0":{"70/0/0/1920":1}},{"41/100/0/1823|56/100/480/911|60/100/0/911|65/100/0/911|56/0/911/0|60/0/0/0|65/0/0/0|56/100/49/455|60/100/0/455|65/100/0/455|41/0/383/0|56/0/72/0|60/0/0/0|65/0/0/0":{"41/100/25/1823|56/100/480/911|60/100/0/911|65/100/0/911|56/0/911/0|60/0/0/0|65/0/0/0|56/100/49/455|60/100/0/455|65/100/0/455|41/0/383/0|56/0/72/0|60/0/0/0|65/0/0/0":1},"41/100/25/1823|56/100/480/911|60/100/0/911|65/100/0/911|56/0/911/0|60/0/0/0|65/0/0/0|56/100/49/455|60/100/0/455|65/100/0/455|41/0/383/0|56/0/72/0|60/0/0/0|65/0/0/0":{"34/100/25/1823|53/100/480/911|58/100/0/911|61/100/0/911|53/0/911/0|58/0/0/0|61/0/0/0|53/100/49/455|58/100/0/455|61/100/0/455|34/0/383/0|53/0/72/0|58/0/0/0|61/0/0/0":1,
"41/100/25/1823|56/100/480/911|60/100/0/911|65/100/0/911|56/0/911/0|60/0/0/0|65/0/0/0|56/100/49/455|60/100/0/455|65/100/0/455|41/0/383/0|56/0/72/0|60/0/0/0|65/0/0/0":32,"48/100/25/1823|51/100/480/911|55/100/0/911|60/100/0/911|51/0/911/0|55/0/0/0|60/0/0/0|51/100/49/455|55/100/0/455|60/100/0/455|48/0/383/0|51/0/72/0|55/0/0/0|60/0/0/0":2},"41/100/25/1823|56/100/480/911|60/100/0/911|65/0/0/0|65/100/0/960|56/0/911/0|60/0/0/0|56/100/49/455|60/100/0/455|65/0/0/0|65/100/0/-1465|41/0/383/0|56/0/72/0|60/0/0/0":{"34/100/25/1823|53/100/480/911|58/100/0/911|61/100/0/911|53/0/911/0|58/0/0/0|61/0/0/0|53/100/49/455|58/100/0/455|61/100/0/455|34/0/383/0|53/0/72/0|58/0/0/0|61/0/0/0":7,
"41/100/25/1823|56/100/480/911|60/100/0/911|65/100/0/911|56/0/911/0|60/0/0/0|65/0/0/0|56/100/49/455|60/100/0/455|65/100/0/455|41/0/383/0|56/0/72/0|60/0/0/0|65/0/0/0":6},"48/100/25/1823|51/100/480/911|55/100/0/911|60/100/0/911|51/0/911/0|55/0/0/0|60/0/0/0|51/100/49/455|55/100/0/455|60/100/0/455|48/0/383/0|51/0/72/0|55/0/0/0|60/0/0/0":{"41/100/25/1823|56/100/480/911|60/100/0/911|65/100/0/911|56/0/911/0|60/0/0/0|65/0/0/0|56/100/49/455|60/100/0/455|65/100/0/455|41/0/383/0|56/0/72/0|60/0/0/0|65/0/0/0":2},
"34/100/25/1823|53/100/480/911|58/100/0/911|61/100/0/911|53/0/911/0|58/0/0/0|61/0/0/0|53/100/49/455|58/100/0/455|61/100/0/455|34/0/383/0|53/0/72/0|58/0/0/0|61/0/0/0":{"34/100/25/1823|53/100/480/911|58/100/0/911|61/100/0/911|53/0/911/0|58/0/0/0|61/0/0/0|53/100/49/455|58/100/0/455|61/100/0/455|34/0/383/0|53/0/72/0|58/0/0/0|61/0/0/0":8,"41/100/25/1823|56/100/480/911|60/100/0/911|65/100/0/911|56/0/911/0|60/0/0/0|65/0/0/0|56/100/49/455|60/100/0/455|65/100/0/455|41/0/383/0|56/0/72/0|60/0/0/0|65/0/0/0":7}}];function render_staves(){var a=new VF.Renderer(notation_div,VF.Renderer.Backends.SVG);a.resize(length,300);context=a.getContext();staves=[new VF.Stave(40,30,length,{right_bar:!1}),new VF.Stave(40,140,length,{right_bar:!1}),new VF.Stave(40,140,length,{right_bar:!1})];x_pos=115;for(a=0;a<staves.length;a++)staves[a].addClef(clefs[a]),staves[a].addKeySignature("Ab"),staves[a].setContext(context).draw(),staves[a].setNoteStartX(x_pos);a=new VF.StaveConnector(staves[0],staves[1]);var b=new VF.StaveConnector(staves[0],
staves[1]);a.setType(VF.StaveConnector.type.BRACE);a.setContext(context);a.setContext(context);a.draw();b.setType(VF.StaveConnector.type.SINGLE);b.setContext(context);b.draw()}
function drawNotes(a,b,d){for(var c=[],g=0;g<a.length;g++){var f=voice_cache[a[g]];f||(f=a[g].split("|"),f=get_voice(f,clefs[g]),voice_cache[a[g]]=f);c=c.concat(f)}a=new VF.Formatter;a.joinVoices([c[0]]);a.joinVoices([c[1],c[2]]);a.format(c,measure_width);g=function(a){return a.setContext(context).draw()};for(f=0;f<c.length;f++){staves[f].setNoteStartX(x_pos);var e=VF.Beam.generateBeams(c[f].getTickables(),{flat_beams:!0,stem_direction:1<=f?-1:1});c[f].draw(context,staves[f]);e.forEach(g)}b&&(b=new VF.TextDynamics({text:b,
duration:"w"}),b=(new VF.Voice({num_beats:4,beat_value:4})).addTickable(b),a.format([b],measure_width),b.draw(context,staves[1]));d&&(text_note=(new VF.TextNote({text:d,duration:"w"})).setLine(-1).setJustification(VF.TextNote.Justification.LEFT).setStave(staves[0]),text_note.font={family:"Georgia",size:14},d=(new VF.Voice({num_beats:4,beat_value:4})).addTickable(text_note),a.format([d],measure_width),d.draw(context,staves[0]))}
function get_voice(a,b){a=a.filter(function(a){if(0<a.split("/")[3])return a});for(var d=[],c=[],g,f=!0,e=0;e<a.length;e++){var k="bass"==b?"b/3":"e/5";if("70/0/0/1920"==a[e]){d.push(new VF.StaveNote({clef:b,keys:[k],duration:"wr"}));break}note=a[e].split("/");if(f&&25<note[2]&&60<note[3]){var l=get_duration(note[2]-50)+"r";d.push(new VF.StaveNote({clef:b,keys:[k],duration:l}))}l=midi_to_note(note[0]);var h=parseInt(note[3]);k=get_duration(h);if(100>h)k=new Vex.Flow.GraceNote({keys:[l],duration:"8",
slash:!0}),g=new Vex.Flow.GraceNoteGroup([k],!0),-1<flats.indexOf(l.split("/")[0])&&k.addAccidental(0,new VF.Accidental("n"));else{for(l=[l];;){h=a[e+1]?a[e+1].split("/"):void 0;if(!h||0<h[2]||0===h[1])break;e+=1;h=midi_to_note(h[0]);l.push(h)}h={clef:b,keys:l,duration:k};h.stem_direction="bass"==b==1?-1:1;h=new VF.StaveNote(h);g&&(h.addModifier(0,g.beamNotes()),g=void 0);"hd"==k&&h.addDotToAll();1==l.length&&-1<flats.indexOf(l[0].split("/")[0])&&h.addAccidental(0,new VF.Accidental("n"));"w"==k?c.push(h):
(d.push(h),f=!1)}}a=new VF.Voice({num_beats:4,beat_value:4});a.addTickables(d);d=[a];0<c.length&&(a=new VF.Voice({num_beats:4,beat_value:4}),a.addTickables(c),d.push(a));return d}function get_annotation(){var a=grammar.flatten("#start#").trim();return a.charAt(0).toUpperCase()+a.slice(1)}function get_duration(a){var b="w";240>=a?b="8":480>=a?b="q":960>=a?b="h":1774>=a&&(b="hd");return b}function midi_to_note(a){return"C Db D Eb E F Gb G Ab A Bb B".split(" ")[a%12]+"/"+(Math.floor(a/12)-1)};var grammar_data={start:"#intro# #verb# #noun#;with #noun#;in #noun#;#intro# be #adverb# #adjective#;#verb# #noun#;#verb# #noun#".split(";"),intro:"so as to;don't;;;;".split(";"),adverb:"very lightly healthily rigorously diligently          ".split(" "),verb:"have;ask;wonder about;consider;ponder;mediate;desecrate;meditate on;reject;bury;conceal;request;defer to;listen to;ignore;repudiate;light;open;widen;experiment with;console;secrete;deliver;obtain;collect;spread out;expand;join;interrogate;answer".split(";"),
noun:"humility;joy;despondence;loneliness;sadness;conviction;clarity;walls;air;water;darkness;benevolence;ill intent;questions;trepidation;fear;tranquility;clairvoyance;wit;a hole;the sound;your head;your body;your hands;yourself;superiority;ingenuity".split(";"),adjective:"calm gaunt moderate slow alone placid turgid transformed translucent ingenious pensive forgetful resourceful illuminated lost lonely transparent liquid kind polite pensive magisterial bureaucratic timid benevolent proud wise lustrous nostalgic indulgent reticent secretive".split(" ")};function createPiano(){Soundfont.instrument(new AudioContext,"acoustic_grand_piano").then(function(a){var b=function(d,c,g){tempo_modifier+=1.1<tempo_modifier?-.01:.001;var f=track_options[g];track_options[g].gain=f.gain>f.gain_center?track_options[g].gain-f.gain/100:track_options[g].gain+f.gain/100;var e=d[c].split("/"),k=[];if(0<e[1]){for(k.push(e[0]);;){e=d[c+1]?d[c+1].split("/"):void 0;if(!e||0<e[2]||0===e[1])break;c+=1;k.push(e[0])}for(e=0;e<k.length;e++)a.play(k[e],0,f)}d[c+1]&&(f=d[c+1].split("/"),
window.setTimeout(b.bind(null,d,c+1,g),f[2]*tempo_modifier))};playMeasure=function(a){tempo_modifier+=(.5-Math.random())/8;if(!current_dynamic||5<dynamic_age){dynamic_age=0;var c=current_dynamic="p"==current_dynamic?"f":"p";track_options[0].gain="p"==current_dynamic?.5:1.5;track_options[1].gain="p"==current_dynamic?.2:.4}else dynamic_age+=1;if(void 0===annotation_age||17<annotation_age){var d=get_annotation();annotation_age=0}annotation_age+=1;for(var f=[],e=0;e<a.length;e++)f.push(a[e].split("|"));
for(e=0;e<a.length;e++){var k=f[e],l=k[0].split("/");window.setTimeout(b.bind(null,k,0,e),l[2]*tempo_modifier)}drawNotes(a,c,d);x_pos+=measure_width;c=[];for(e=0;e<a.length;e++)c.push(weighted_random(dists[e][a[e]]));x_pos>length-measure_width&&render_staves();window.setTimeout(playMeasure.bind(null,c),1920*tempo_modifier)};document.getElementById("start").removeAttribute("disabled")})};
